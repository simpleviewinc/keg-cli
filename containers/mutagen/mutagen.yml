# Set up the Mutagen service and code volume before creating sessions.
beforeCreate:
  - docker-compose up --build --detach mutagen

# Set up the main services after creating sessions. At this point, sessions will
# have been established and code pushed to the shared volume.
afterCreate:
  - docker-compose up --build --detach

# Pause services after pausing sessions.
afterPause:
  - docker-compose stop

# Resume services before resume sessions.
beforeResume:
  - docker-compose start

# Tear down all services and remove the code volume after terminating sessions.
afterTerminate:
  - docker-compose down --rmi=all --volumes

# Define common utility commands.
commands:
  logs: docker-compose logs --follow

# Forward local traffic to the web and API servers.
forward:
  kegapp:
    source: "tcp:localhost:80"
    destination: "docker://${CONTAINER_NAME}:tcp:kegapp:19006"

# Synchronize code to the shared Docker volume via the Mutagen service.
sync:
  defaults:
    flushOnCreate: true
    ignore:
      vcs: true
  keg-code:
    alpha: "${CONTEXT_PATH}"
    beta: "docker://${DOC_APP_PATH}"
    mode: "two-way-resolved"
    ignore:
      paths:
        - "/*"
        - "!/core/"
        - "!/{index.js,tap.json,app.json,App.js,babelconfig.js,metro.config.js,package.json,webpack.config.js}"
